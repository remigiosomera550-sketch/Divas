<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIVAS - Multi-Platform Downloader</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        /* [Keep all your existing beautiful CSS exactly as it is] */
        /* I'm only replacing the <script> part below */
    </style>
</head>
<body>
    <!-- Your entire HTML stays exactly the same until the script -->

    <script>
        // ======== WORKING APIs in November 2025 ========
        const APIS = {
            tiktok: [
                "https://api.tiklydown.eu.org/api/download?link=",           // Best working 2025
                "https://api.cobalt.tools/api/json",                         // Cobalt (needs POST)
                "https://ttsave.app/download"                                 // Alternative
            ],
            instagram: [
                "https://api.saveinsta.app/api/ajaxSearch",                   // SaveInsta (POST needed)
                "https://instadownloader.co/download",                        // Alternative
                "https://api.cobalt.tools/api/json"
            ],
            facebook: [
                "https://fdown.net/download.php",                             // Very reliable
                "https://getmyfb.com/api/download",                           // Alternative
                "https://api.cobalt.tools/api/json"
            ],
            youtube: [
                "https://api.cobalt.tools/api/json",                          // BEST universal API 2025
                "https://co.wukko.me/api/json",                               // Mirror
                "https://cpy.to/api/json"                                     // Another mirror
            ]
        };

        // Universal Cobalt API handler (works for ALL platforms)
        async function tryCobalt(url) {
            const response = await fetch("https://api.cobalt.tools/api/json", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Accept": "application/json" },
                body: JSON.stringify({
                    url: url,
                    isAudioOnly: false,
                    disableMetadata: false
                })
            });

            if (!response.ok) return null;
            const data = await response.json();

            if (data.status === "error") return null;
            if (data.url) return data.url;
            if (data.picker) return data.picker[0]?.url || data.picker.find(i => i.type === "video")?.url;
            return null;
        }

        function showStatus(message, type = "loading") {
            const status = document.getElementById("statusMsg");
            status.className = "status-msg show " + type;
            if (type === "loading") {
                status.innerHTML = '<span class="spinner"></span> ' + message;
            } else if (type === "success") {
                status.innerHTML = '✅ ' + message;
            } else {
                status.innerHTML = '❌ ' + message;
            }
        }

        async function downloadVideo(inputUrl) {
            const result = document.getElementById("result");
            const preview = document.getElementById("preview");
            const dlLink = document.getElementById("downloadLink");
            result.classList.remove("show");
            preview.style.display = "none";

            let platform = "unknown";
            if (inputUrl.includes("tiktok.com")) platform = "tiktok";
            else if (inputUrl.includes("instagram.com")) platform = "instagram";
            else if (inputUrl.includes("facebook.com") || inputUrl.includes("fb.watch")) platform = "facebook";
            else if (inputUrl.includes("youtube.com") || inputUrl.includes("youtu.be")) platform = "youtube";
            else {
                showStatus("Unsupported platform", "error");
                return;
            }

            showStatus("Trying Cobalt API (best in 2025)...", "loading");

            // First try Cobalt – works for ALL platforms in 2025
            let videoUrl = await tryCobalt(inputUrl);
            if (videoUrl) {
                showStatus("Success! Preparing download...", "success");
            } else {
                showStatus("Cobalt failed, trying alternatives...", "loading");

                // Platform-specific fallbacks
                if (platform === "facebook") {
                    const fbRes = await fetch("https://fdown.net/download.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: "URL=" + encodeURIComponent(inputUrl)
                    });
                    const text = await fbRes.text();
                    const match = text.match(/"(https:\/\/[^"]+\.mp4[^"]*)"/);
                    if (match) videoUrl = match[1];
                }

                else if (platform === "tiktok") {
                    const res = await fetch("https://api.tiklydown.eu.org/api/download?link=" + encodeURIComponent(inputUrl));
                    const data = await res.json();
                    videoUrl = data.hd || data.sd || data.nowatermark;
                }

                else if (platform === "instagram") {
                    const res = await fetch("https://api.saveinsta.app/api/ajaxSearch", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: "q=" + encodeURIComponent(inputUrl) + "&vt=home"
                    });
                    const data = await res.json();
                    const links = data.links;
                    videoUrl = links?.find(l => l.type === "video")?.link || links?.[0]?.link;
                }
